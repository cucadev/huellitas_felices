extends ../layouts/main.pug

block extraCSS
  // FullCalendar CSS
  link(rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.css")
  style.
    .fc-nuevaCita-button {
      background-color: #28a745 !important;
      border-color: #28a745 !important;
      color: white !important;
      margin-left: 10px;
    }
    .fc-nuevaCita-button:hover {
      background-color: #218838 !important;
      border-color: #1e7e34 !important;
    }

block content
  .container-fluid.py-4
    .row
      .col-12
        .card.shadow-sm
          .card-header.bg-primary.text-white.d-flex.justify-content-between.align-items-center
            h4.mb-0
              i.bi.bi-calendar-check-fill.me-2
              | Agenda Veterinaria de Turnos
          .card-body
            #calendar

    // Modal para Nueva Cita
    .modal.fade(
      id="modalCita",
      tabindex="-1",
      aria-labelledby="modalCitaLabel",
      aria-hidden="true"
    )
      .modal-dialog.modal-xl
        .modal-content
          .modal-header
            h5.modal-title(id="modalCitaLabel")
              i.fas.fa-calendar-plus.me-2
              | Agendar Nueva Cita
            button.btn-close(type="button", data-bs-dismiss="modal", aria-label="Close")
          .modal-body
            form#formCita
              .row
                // Primera fila: Título, Fecha, Hora, Veterinario
                .col-md-3
                  .mb-3
                    label.form-label(for="titulo") Título de la Cita
                    input.form-control(type="text", id="titulo", required)
                .col-md-3
                  .mb-3
                    label.form-label(for="fecha") Fecha
                    input.form-control(type="date", id="fecha", required)
                .col-md-3
                  .mb-3
                    label.form-label(for="hora") Hora
                    input.form-control(type="time", id="hora", required)
                .col-md-3
                  .mb-3
                    label.form-label(for="veterinario") Veterinario
                    select.form-select(id="veterinario", required)
                      option(value="") Seleccionar veterinario...
                      option(value="Dr. García") Dr. García
                      option(value="Dra. López") Dra. López
                      option(value="Dr. Martínez") Dr. Martínez
              hr.my-3
              // Segunda fila: Datos del Cliente
              .col-12
                h6.text-muted.mb-3
                  i.fas.fa-user.me-2
                  | Datos del Cliente
              .row
                .col-md-3
                  .mb-3
                    label.form-label(for="dni") DNI del Cliente
                    .input-group
                      input.form-control(type="text", id="dni", required)
                      button.btn.btn-outline-secondary(type="button", id="btnBuscarCliente")
                        i.bi.bi-search
                .col-md-3
                  .mb-3
                    label.form-label(for="nombre") Nombre
                    input.form-control(type="text", id="nombre", readonly)
                .col-md-3
                  .mb-3
                    label.form-label(for="apellido") Apellido
                    input.form-control(type="text", id="apellido", readonly)
                .col-md-3
                  .mb-3
                    label.form-label(for="telefono") Teléfono
                    input.form-control(type="tel", id="telefono", readonly)
              .row
                .col-md-6
                  .mb-3
                    label.form-label(for="email") Email
                    input.form-control(type="email", id="email", readonly)
              hr.my-3
              // Tercera fila: Datos de la Mascota
              .col-12
                h6.text-muted.mb-3
                  i.fas.fa-paw.me-2
                  | Datos de la Mascota
              .row
                .col-md-4
                  .mb-3
                    label.form-label(for="nombreMascota") Nombre de la Mascota
                    input.form-control(type="text", id="nombreMascota", required)
                .col-md-4
                  .mb-3
                    label.form-label(for="tipoMascota") Tipo de Mascota
                    select.form-select(id="tipoMascota", required)
                      option(value="") Seleccionar...
                      option(value="Perro") Perro
                      option(value="Gato") Gato
                .col-md-4
                  .mb-3
                    label.form-label(for="observaciones") Motivo de la Consulta / Observaciones
                    textarea.form-control(id="observaciones", rows="2", required)
          .modal-footer
            button.btn.btn-secondary(type="button", data-bs-dismiss="modal") Cancelar
            button.btn.btn-primary(type="submit")
              i.fas.fa-save.me-1
              | Guardar Cita

block extraJS
  script(src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js")
  script(src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/locales/es.global.min.js")
  script.
    document.addEventListener('DOMContentLoaded', function() {
      const calendarEl = document.getElementById('calendar');
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'es',
        headerToolbar: {
          left: 'prev,next nuevaCita',  // Botón Nueva Cita a la izquierda junto a las flechas
          center: 'title',  // Título del mes y año en el centro
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        buttonText: {
          today:    'Hoy',
          month:    'Mes',
          week:     'Semana',
          day:      'Día',
          list:     'Lista'
        },
        customButtons: {
          nuevaCita: {
            text: '+ Agendar turno nuevo',
            click: function() {
              const modal = new bootstrap.Modal(document.getElementById('modalCita'));
              modal.show();
            }
          }
        },
        events: [],
        dateClick: function(info) {
          const modal = new bootstrap.Modal(document.getElementById('modalCita'));
          document.getElementById('fecha').value = info.dateStr;
          modal.show();
        },
        eventClick: function(info) {
          alert('Evento: ' + info.event.title);
        },
        selectable: true,
        editable: true,
      });
      calendar.render();

      document.getElementById('formCita').addEventListener('submit', function(e) {
        e.preventDefault();
        const title = document.getElementById('titulo').value;
        const date = document.getElementById('fecha').value;
        const time = document.getElementById('hora').value;
        const start = date + 'T' + time;

        calendar.addEvent({
          title: title,
          start: start,
          allDay: false,
        });

        const modal = bootstrap.Modal.getInstance(document.getElementById('modalCita'));
        modal.hide();
        this.reset();
      });

      document.getElementById('btnBuscarCliente').addEventListener('click', function() {
        const dni = document.getElementById('dni').value;
        if (dni === '12345678') {
          document.getElementById('nombre').value = 'Juan';
          document.getElementById('apellido').value = 'Pérez';
          document.getElementById('telefono').value = '1234567890';
          document.getElementById('email').value = 'juan.perez@example.com';
        } else {
          alert('Cliente no encontrado');
        }
      });
    });
